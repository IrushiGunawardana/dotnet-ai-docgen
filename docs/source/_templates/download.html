{%- extends "layout.html" %}
{%- block extrahead %}
    {{ super() }}
    <link rel="stylesheet" href="{{ pathto('_static/custom.css', 1) }}" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
{% endblock %}

{%- block content %}
<div class="download-section">
    <h2><i class="fas fa-download"></i> Download Documentation</h2>
    <p style="color: #fff; margin-bottom: 1.5em;">Download the complete documentation in various formats</p>
    <div class="download-buttons">
        <a href="#" class="download-btn" onclick="downloadAsPDF()">
            <i class="fas fa-file-pdf"></i> Download as PDF
        </a>
        <a href="#" class="download-btn" onclick="downloadAsHTML()">
            <i class="fas fa-file-archive"></i> Download as HTML (ZIP)
        </a>
        <a href="#" class="download-btn" onclick="downloadAsMarkdown()">
            <i class="fas fa-file-alt"></i> Download as Markdown
        </a>
    </div>
</div>

<script>
function downloadAsPDF() {
    // Trigger browser print to PDF
    window.print();
}

function downloadAsHTML() {
    // Create a zip of the HTML documentation
    fetch('/download-html')
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'documentation.zip';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        })
        .catch(error => {
            alert('Download failed. Please use the browser print function to save as PDF.');
            console.error('Download error:', error);
        });
}

function downloadAsMarkdown() {
    // Convert current page to markdown
    const content = document.querySelector('.rst-content').innerText;
    const blob = new Blob([content], { type: 'text/markdown' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'documentation.md';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
}
</script>

{{ super() }}
{% endblock %}

